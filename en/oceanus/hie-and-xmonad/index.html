<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width" />
    
    <link rel="stylesheet" href="https://quinoa42.github.io/style/site.min.css">
    <title>
  Set up haskell-ide-engine and xmonad &ndash; Emain Ablach
</title>
  </head>
  <body>
    <header id="header">
      <div class="heading left">
        
        <a class="logo" href="/en/" title="">Emain Ablach</a>
        
        
        <a class="lang-op" href="/en/" title="">en</a>
        
        <a class="lang-op" href="/jp/" title="">jp</a>
        
        <a class="lang-op" href="/zh/" title="">zh</a>
        
      </div>
      <div class="right">
        <nav class="jumplist">
          <ul>
            
            
            <li>
              <a href="/en/oceanus/" title="">Oceanus</a>
            </li>
            
            <li>
              <a href="/en/whimsia/" title="">Whimsia</a>
            </li>
            
          </ul>
        </nav>
        <nav class="jumplist">
          <ul>
            
            
            <li>
              <a href="/en/about" title="">About</a>
            </li>
            
            <li>
              <a href="/en/dot-emacs" title="">init.el</a>
            </li>
            
          </ul>
        </nav>
      </div>
    </header>
    <main>
    
<article>
  <header>
    <h1>Set up haskell-ide-engine and xmonad</h1>
    <div class="reading-info">
      <div class="left">
        <span>550 words</span>
        <span>
          &bull;
        </span>
        <span>3 min read</span>
      </div>
      <div class="right">
        <span><time>published at 07-09-2019</time></span>
        <span>
          &bull;
        </span>
        <span><time>last modified at 01-02-2021</time></span>
      </div>
    </div>
  </header>
  <p>Now that I have tons of time during this break, I decided to <a href="http://learnyouahaskell.com/">learn myself a haskell</a> and as a way to apply what I&rsquo;ve learned, I&rsquo;ve planed to switch from <a href="https://awesomewm.org">awesomeWM</a> to <a href="https://xmonad.org">xmonad</a>. Besides, I&rsquo;ve being troubled with my awesome config&rsquo;s memory leak, which I haven&rsquo;t got the chance to look deeply into, so this might be a good chance to give xmonad a try. However, it spent me a while figuring out how to set the dev environment for xmonad.</p>
<h2 id="tool-used">Tool used</h2>
<p>Short version: do not use Arch&rsquo;s <code>ghc</code> and xmonad installed via pacman.</p>
<p>Conceptually I end up with a separation of things I deal with that need a dev environment (<a href="https://github.com/commercialhaskell/stack">stack</a>, xmonad, and scripting) and things that I just &ldquo;use&rdquo; (<a href="https://pandoc.org/#">pandoc</a> and <a href="https://github.com/jaor/xmobar">xmobar</a>). The former is around <code>stack</code> and the static-linked environment it comes with, which I got by installing <a href="https://aur.archlinux.org/packages/stack-static/">stack-static</a> on AUR, and the latter is simply pacman-installed. This mimics the way I deal with Rust on Arch: my personal projects and other stuff are built around pacman-installed <code>rustup</code>, while <code>exa</code>, <code>ripgrep</code> and other tools are simply pacman managed.</p>
<p>At this point after having a static-linked stack, <code>stack setup</code> will give you the static-linked ghc and ghci as <a href="https://brianbuccola.com/how-to-install-xmonad-and-xmobar-via-stack/">Brian Buccola suggested</a>.</p>
<p>Make sure stack&rsquo;s bin path is in your $PATH, which can be set in <code>~/.stack/config.yaml</code>, like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#1e90ff;font-weight:bold">local-bin-path</span>:<span style="color:#bbb"> </span>/home/quinoa42/bin<span style="color:#bbb">
</span></code></pre></div><p>Then you&rsquo;d want the <a href="https://github.com/haskell/haskell-ide-engine">haskell-ide-engine</a>, which is a lsp-compatible language server for Haskell, like <code>rls</code> for Rust. To install it simply do:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">stack install cabal-install <span style="color:#aaa;font-style:italic"># static-linked cabal-install, seems required</span>
git clone https://github.com/haskell/haskell-ide-engine --recurse-submodules
<span style="color:#0aa">cd</span> haskell-ide-engine
stack ./install.hs hie-8.6.5
</code></pre></div><p>You might also want <a href="https://hoogle.haskell.org">hoogle</a> for documentation lookup, which can be installed directly via pacman because it read from <code>Hackage</code> directly (if my understanding is correct).</p>
<p>Now that we have all the tools we need, we can set up our editor&rsquo;s LSP client (for which I use neovim and <code>LSPClient-neovim</code> btw) to use <code>hie-wrapper</code> when editing a haskell file.</p>
<h2 id="stack-driven-xmonad-config">Stack-driven Xmonad config</h2>
<p>This part is based on a combination of blog posts from <a href="https://qiita.com/aiya000/items/be55d899e9c92dd57c35">aiya000</a>, <a href="https://brianbuccola.com/how-to-install-xmonad-and-xmobar-via-stack/">Brian Buccola</a> and <a href="https://www.ncaq.net/2019/02/05/15/42/31/">ncaq</a>.</p>
<p>To begin with, inside your <code>~/.xmonad</code>, create a new <code>stack.yaml</code>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">resolver: lts-13.27

packages:
  - .
</code></pre></div><p>Then add a new <code>package.yaml</code> as <a href="https://www.ncaq.net/2019/02/05/15/42/31/">ncaq</a> suggest:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">name: xmonad-&lt;yourname&gt;
version: 0.1.0
synopsis: xmonad setting
github: &lt;yourname&gt;/.xmonad
author: &lt;yourname&gt;
maintainer: &lt;youremail&gt;@example.com
copyright: © &lt;yourname&gt;
license: MIT
dependencies:
  - X11
  - base
  - xmonad
  - xmonad-contrib
executables:
  xmonad:
    main: xmonad.hs
    ghc-options:
      - -Wall
      - -fwarn-tabs
      - -threaded
      - -O2
      - -with-rtsopts=-N4
</code></pre></div><p>And <code>stack install</code> should compile your favorite <code>xmonad</code> executable into the bin path.</p>
<p>To make xmonad&rsquo;s own compile system (<code>xmonad --recompile</code>) work, create an executable script <code>build</code> at the same dir level as <a href="https://brianbuccola.com/how-to-install-xmonad-and-xmobar-via-stack/">Brian Buccola</a> suggests:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#aaa;font-style:italic"># ~/.xmonad/build</span>
<span style="color:#aaa;font-style:italic">#!/bin/sh</span>

stack ghc -- <span style="color:#a50">\
</span><span style="color:#a50"></span>  --make xmonad.hs <span style="color:#a50">\
</span><span style="color:#a50"></span>  -i <span style="color:#a50">\
</span><span style="color:#a50"></span>  -ilib <span style="color:#a50">\
</span><span style="color:#a50"></span>  -fforce-recomp <span style="color:#a50">\
</span><span style="color:#a50"></span>  -main-is main <span style="color:#a50">\
</span><span style="color:#a50"></span>  -v0 <span style="color:#a50">\
</span><span style="color:#a50"></span>  -Wall <span style="color:#a50">\
</span><span style="color:#a50"></span>  -fwarn-tabs <span style="color:#a50">\
</span><span style="color:#a50"></span>  -threaded <span style="color:#a50">\
</span><span style="color:#a50"></span>  -O2 <span style="color:#a50">\
</span><span style="color:#a50"></span>  -with-rtsopts=-N4 <span style="color:#a50">\
</span><span style="color:#a50"></span>  -o <span style="color:#a50">&#34;</span><span style="color:#a00">$1</span><span style="color:#a50">&#34;</span>

<span style="color:#0aa">exec</span> install xmonad-x86_64-linux ~/bin/xmonad
</code></pre></div><p>Now you have a full dev environment around xmonad!</p>
<p><code>~/.xmonad</code> now looks like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">.
├── build
├── package.yaml
├── stack.yaml
├── stack.yaml.lock
├── xmonad-xxx.cabal
└── xmonad.hs
</code></pre></div><h2 id="inspiration-and-reference">Inspiration and Reference</h2>
<ul>
<li><a href="https://www.reddit.com/r/haskell/comments/7a1ty3/whats%5Fthe%5Fcorrect%5Fway%5Fto%5Finstall%5Fghc%5Fand%5Fcabal%5Fon/">Whats the &lsquo;correct&rsquo; way to install ghc and cabal on arch linux?</a> on <a href="https://www.reddit.com/r/xmonad/">r/haskell</a></li>
<li><a href="https://www.reddit.com/r/xmonad/comments/73z1ew/could%5Fnot%5Ffind%5Fmodule/">Could not find module</a> on <a href="https://www.reddit.com/r/xmonad/">r/xmonad</a></li>
<li><a href="https://brianbuccola.com/how-to-install-xmonad-and-xmobar-via-stack/">How to install xmonad and xmobar via stack</a> by Brian Buccola</li>
<li><a href="https://www.ncaq.net/2019/02/05/15/42/31/">EmacsのHaskellの開発環境をinteroからHaskell IDE Engineに移行しました</a> by ncaq (in Japanese)</li>
<li><a href="https://qiita.com/aiya000/items/be55d899e9c92dd57c35">xmonad.hsでモジュール分割をする</a> by aiya000 (in Japanese)</li>
</ul>
  <footer class="reading-info">
    <div class="left">
       <div class="tags">
    &#x1f3f7;
    <nav class="jumplist">
        <ul>
          
    
    
    <li><a href="https://quinoa42.github.io/en/categories/software/">software</a></li>
    


          
    
    
    <li><a href="https://quinoa42.github.io/en/tags/haskell/">Haskell</a></li>
    

    
    
    <li><a href="https://quinoa42.github.io/en/tags/xmonad/">xmonad</a></li>
    

    
    
    <li><a href="https://quinoa42.github.io/en/tags/vim/">Vim</a></li>
    

    
    
    <li><a href="https://quinoa42.github.io/en/tags/archlinux/">ArchLinux</a></li>
    


        </ul>
    </nav>
</div>

    </div>
    <div class="right">
      <a href="https://quinoa42.github.io/en/oceanus/hie-and-xmonad/">permalink to this post</a>
    </div>
  </footer>
</article>

    </main>
    <footer id="footer">
    
    <hr />
    <div><a href="https://github.com/quinoa42">GitHub</a></div>
    <div><a href="https://bgm.tv/user/112851">Bangumi</a></div>
    <div><a href="https://myanimelist.net/profile/quinoa42">MyAnimeList</a></div>
    
    </footer>
  </body>
</html>
