<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width" />
    
    <link rel="stylesheet" href="https://quinoa42.github.io/style/site.min.css">
    <title>
  Vim &ndash; Emain Ablach
</title>
  </head>
  <body>
    <header id="header">
      <div class="logo"><a href="https://quinoa42.github.io/">Emain Ablach</a></div>
      <nav class="jumplist">
        <ul>
          
          <li><a href="https://quinoa42.github.io/en/oceanus/">Oceanus</a></li>
          
          <li><a href="https://quinoa42.github.io/en/whimsia/">Whimsia</a></li>
          
        </ul>
      </nav>
    </header>
    <main>
    
  
      <article class="post-item">
        <header>
          <div class="tt">
            <h1><a href="/en/oceanus/hie-and-xmonad/">Set up haskell-ide-engine and xmonad</a></h1>
            <time>07-09-2019</time>
          </div>
          <div class="reading-info">
            <div class="left">
             <div class="tags">
    &#x1f3f7;
    <nav class="jumplist">
        <ul>
          
    
    
    <li><a href="https://quinoa42.github.io/en/categories/software/">software</a></li>
    


          
    
    
    <li><a href="https://quinoa42.github.io/en/tags/haskell/">Haskell</a></li>
    

    
    
    <li><a href="https://quinoa42.github.io/en/tags/xmonad/">xmonad</a></li>
    

    
    
    <li><a href="https://quinoa42.github.io/en/tags/vim/">Vim</a></li>
    

    
    
    <li><a href="https://quinoa42.github.io/en/tags/archlinux/">ArchLinux</a></li>
    


        </ul>
    </nav>
</div>

            </div>
            <div class="right">
              <span>552 words</span>
              <span>
                &bull;
              </span>
              <span>3 min read</span>
            </div>
          </div>
        </header>
        

<p>Now that I have tons of time during this break, I decided to <a href="http://learnyouahaskell.com/">learn myself a haskell</a> and as a way to apply what I&rsquo;ve learned, I&rsquo;ve planed to switch from <a href="https://awesomewm.org">awesomeWM</a> to <a href="https://xmonad.org">xmonad</a>. Besides, I&rsquo;ve being troubled with my awesome config&rsquo;s memory leak, which I haven&rsquo;t got the chance to look deeply into, so this might be a good chance to give xmonad a try. However, it spent me a while figuring out how to set the dev environment for xmonad.</p>

<h2 id="tool-used">Tool used</h2>

<p>Short version: do not use Arch&rsquo;s <code>ghc</code> and xmonad installed via pacman.</p>

<p>Conceptually I end up with a separation of things I deal with that need a dev environment (<a href="https://github.com/commercialhaskell/stack">stack</a>, xmonad, and scripting) and things that I just &ldquo;use&rdquo; (<a href="https://pandoc.org/#">pandoc</a> and <a href="https://github.com/jaor/xmobar">xmobar</a>). The former is around <code>stack</code> and the static-linked environment it comes with, which I got by installing <a href="https://aur.archlinux.org/packages/stack-static/">stack-static</a> on AUR, and the latter is simply pacman-installed. This mimics the way I deal with Rust on Arch: my personal projects and other stuff are built around pacman-installed <code>rustup</code>, while <code>exa</code>, <code>ripgrep</code> and other tools are simply pacman managed.</p>

<p>At this point after having a static-linked stack, <code>stack setup</code> will give you the static-linked ghc and ghci as <a href="https://brianbuccola.com/how-to-install-xmonad-and-xmobar-via-stack/">Brian Buccola suggested</a>.</p>

<p>Make sure stack&rsquo;s bin path is in your $PATH, which can be set in <code>~/.stack/config.yaml</code>, like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">local-bin-path: /home/quinoa42/bin</code></pre></div>
<p>Then you&rsquo;d want the <a href="https://github.com/haskell/haskell-ide-engine">haskell-ide-engine</a>, which is a lsp-compatible language server for Haskell, like <code>rls</code> for Rust. To install it simply do:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">stack install cabal-install <span style="color:#75715e"># static-linked cabal-install, seems required</span>
git clone https://github.com/haskell/haskell-ide-engine --recurse-submodules
cd haskell-ide-engine
stack ./install.hs hie-8.6.5</code></pre></div>
<p>You might also want <a href="https://hoogle.haskell.org">hoogle</a> for documentation lookup, which can be installed directly via pacman because it read from <code>Hackage</code> directly (if my understanding is correct).</p>

<p>Now that we have all the tools we need, we can set up our editor&rsquo;s LSP client (for which I use neovim and <code>LSPClient-neovim</code> btw) to use <code>hie-wrapper</code> when editing a haskell file.</p>

<h2 id="stack-driven-xmonad-config">Stack-driven Xmonad config</h2>

<p>This part is based on a combination of blog posts from <a href="https://qiita.com/aiya000/items/be55d899e9c92dd57c35">aiya000</a>, <a href="https://brianbuccola.com/how-to-install-xmonad-and-xmobar-via-stack/">Brian Buccola</a> and <a href="https://www.ncaq.net/2019/02/05/15/42/31/">ncaq</a>.</p>

<p>To begin with, inside your <code>~/.xmonad</code>, create a new <code>stack.yaml</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">resolver: lts-13.27

packages:
  - .</code></pre></div>
<p>Then add a new <code>package.yaml</code> as <a href="https://www.ncaq.net/2019/02/05/15/42/31/">ncaq</a> suggest:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">name: xmonad-&lt;yourname&gt;
version: 0.1.0
synopsis: xmonad setting
github: &lt;yourname&gt;/.xmonad
author: &lt;yourname&gt;
maintainer: &lt;youremail&gt;@example.com
copyright: © &lt;yourname&gt;
license: MIT
dependencies:
  - X11
  - base
  - xmonad
  - xmonad-contrib
executables:
  xmonad:
    main: xmonad.hs
    ghc-options:
      - -Wall
      - -fwarn-tabs
      - -threaded
      - -O2
      - -with-rtsopts=-N4</code></pre></div>
<p>And <code>stack install</code> should compile your favorite <code>xmonad</code> executable into the bin path.</p>

<p>To make xmonad&rsquo;s own compile system (<code>xmonad --recompile</code>) work, create an executable script <code>build</code> at the same dir level as <a href="https://brianbuccola.com/how-to-install-xmonad-and-xmobar-via-stack/">Brian Buccola</a> suggests:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># ~/.xmonad/build</span>
<span style="color:#75715e">#!/bin/sh</span>

stack ghc -- <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  --make xmonad.hs <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -i <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -ilib <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -fforce-recomp <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -main-is main <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -v0 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -Wall <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -fwarn-tabs <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -threaded <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -O2 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -with-rtsopts<span style="color:#f92672">=</span>-N4 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  -o <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span>

exec install xmonad-x86_64-linux ~/bin/xmonad</code></pre></div>
<p>Now you have a full dev environment around xmonad!</p>

<p><code>~/.xmonad</code> now looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">.
├── build
├── package.yaml
├── stack.yaml
├── stack.yaml.lock
├── xmonad-xxx.cabal
└── xmonad.hs</code></pre></div>
<h2 id="inspiration-and-reference">Inspiration and Reference</h2>

<ul>
<li><a href="https://www.reddit.com/r/haskell/comments/7a1ty3/whats%5Fthe%5Fcorrect%5Fway%5Fto%5Finstall%5Fghc%5Fand%5Fcabal%5Fon/">Whats the &lsquo;correct&rsquo; way to install ghc and cabal on arch linux?</a> on <a href="https://www.reddit.com/r/xmonad/">r/haskell</a></li>
<li><a href="https://www.reddit.com/r/xmonad/comments/73z1ew/could%5Fnot%5Ffind%5Fmodule/">Could not find module</a> on <a href="https://www.reddit.com/r/xmonad/">r/xmonad</a></li>
<li><a href="https://brianbuccola.com/how-to-install-xmonad-and-xmobar-via-stack/">How to install xmonad and xmobar via stack</a> by Brian Buccola</li>
<li><a href="https://www.ncaq.net/2019/02/05/15/42/31/">EmacsのHaskellの開発環境をinteroからHaskell IDE Engineに移行しました</a> by ncaq (in Japanese)</li>
<li><a href="https://qiita.com/aiya000/items/be55d899e9c92dd57c35">xmonad.hsでモジュール分割をする</a> by aiya000 (in Japanese)</li>
</ul>

      </article>
  
      <article class="post-item">
        <header>
          <div class="tt">
            <h1><a href="/en/oceanus/vimtex-user-defined-completion/">Auto-complete user-defined LaTeX packages and classes with Vimtex</a></h1>
            <time>05-17-2019</time>
          </div>
          <div class="reading-info">
            <div class="left">
             <div class="tags">
    &#x1f3f7;
    <nav class="jumplist">
        <ul>
          
    
    
    <li><a href="https://quinoa42.github.io/en/categories/software/">software</a></li>
    


          
    
    
    <li><a href="https://quinoa42.github.io/en/tags/vim/">Vim</a></li>
    

    
    
    <li><a href="https://quinoa42.github.io/en/tags/latex/">latex</a></li>
    


        </ul>
    </nav>
</div>

            </div>
            <div class="right">
              <span>363 words</span>
              <span>
                &bull;
              </span>
              <span>2 min read</span>
            </div>
          </div>
        </header>
        

<p><a href="https://github.com/lervag/vimtex">vimtex</a> is one of the most commonly used LaTeX plugin (which is also what I use) in the vim community that supports auto-completion, conceal, synctex pdf preview, and many other modern features. In the last few months after I switched to Linux, the macros I defined in my LaTeX template has grown to such an extent that I have to move them into separate packages and classes. Doing so is <a href="https://en.wikibooks.org/wiki/LaTeX/Creating%5FPackages">quite easy</a>, but I got a problem: the commands in my own packages and classes are not in the candidate list of auto-completion!</p>

<h2 id="auto-complete-usepackage-and-documentclass">Auto-Complete <code>\usepackage</code> and <code>\documentclass</code></h2>

<p>This is fairly easy: put them into <code>$TEXMFHOME</code> with a directory structure like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">texmf
└── tex
   └── latex
      ├── mlaarticle
      │  └── mlaarticle.cls
      └── proofh
         └── proofh.sty</code></pre></div>
<p>Then it should work out of the box, otherwise try <code>sudo hashtex</code>.</p>

<h2 id="auto-complete-new-commands-and-environments">Auto-complete new commands and environments</h2>

<p>The problem is that commands and environments defined in these new packages are not in the candidate lists at all! It is easy to see from <a href="https://github.com/lervag/vimtex/tree/master/autoload/vimtex/complete">vimtex source code</a> that these completion candidates are mostly hard-coded. Thus, the only things we need to do is to create files corresponding to our packages in this given format, and put them inside <code>vimtex/autoload/vimtex/complete</code>.</p>

<p>The candidate file format is very straightforward: file is named <code>SOMEPACKAGE</code> if it is for a package of the same name, and <code>class-SOMECLASS</code> if it is for a class of the same name. In each file, candidates are separated by new lines, and to declare a command it will simply be its name, and to declare an environment it will be something like <code>\begin{ENV}</code>. After making this kind of files, the auto-completion works for our own packages!</p>

<h2 id="further-readings">Further Readings</h2>

<p>LaTeX is not only great at scientific and technical writing, but also a great way to do most things you do with Docs and PowerPoints, because it is easy to set up your own content-and-format-independent templates, which enable better concentration on the content itself. Here are many resources that worth reading:</p>

<ul>
<li><a href="https://en.wikibooks.org/wiki/LaTeX/Creating%5FPackages">LaTeX/Creating Packages</a> on Wikibooks</li>
<li><a href="https://castel.dev/post/lecture-notes-1/">How I&rsquo;m able to take notes in mathematics lectures using LaTeX and Vim</a> by Gilles Castel</li>
<li><a href="https://liam.page/2019/03/18/separation-of-content-and-presentation/">到底什么是「内容与样式分离」</a> by Liam Huang</li>
<li><a href="https://junyixu.github.io/2019/03/08/Happy-LaTeXing/">在 ArchLinux 上愉快地 LaTeXing</a> by Junix</li>
</ul>

      </article>
  
      <article class="post-item">
        <header>
          <div class="tt">
            <h1><a href="/en/oceanus/vim8-package-opt-after/">A workaround that handles after directory scripts for optional packages of Vim8</a></h1>
            <time>01-22-2019</time>
          </div>
          <div class="reading-info">
            <div class="left">
             <div class="tags">
    &#x1f3f7;
    <nav class="jumplist">
        <ul>
          
    
    
    <li><a href="https://quinoa42.github.io/en/categories/software/">software</a></li>
    


          
    
    
    <li><a href="https://quinoa42.github.io/en/tags/vim/">Vim</a></li>
    


        </ul>
    </nav>
</div>

            </div>
            <div class="right">
              <span>318 words</span>
              <span>
                &bull;
              </span>
              <span>2 min read</span>
            </div>
          </div>
        </header>
        

<p>Since I started to use Arch Linux, I&rsquo;ve also switched from using plugins such as <a href="https://github.com/junegunn/vim-plug">vim-plug</a> to using the native Vim8 packages utility. However, I encountered the problem where if we do <code>packadd SOMEPACKAGE</code> after (Neo)vim has initialized, and unfortunately if this plugin comes with an <code>after</code> directory, for example in an <code>autocmd</code> such as <code>autocmd FileType python vim-textobj-python</code>, the plugin will not work correctly due to the way Vim8 packages utility handles <code>after</code> directories.</p>

<h2 id="what-s-done-by-vim-when-calling-packadd">What&rsquo;s done by Vim when calling packadd?</h2>

<p>This is well explained in the <a href="https://neovim.io/doc/user/repeat.html#:packadd">official documentation</a>. In short, when <code>packadd</code> is called explicitly, Vim will source <code>plugin/*.vim</code> under the package directory, and simply add <code>after</code> directory to the <code>runtimepath</code>. This causes the problem because scripts in the <code>after</code> directory are never sourced if the <code>packadd</code> happens after Vim has totally initialized, which it will be the case for a <code>packadd</code> invoked in <code>autocmd</code>.</p>

<h2 id="how-to-fix-it">How to fix it?</h2>

<p>Well, since it&rsquo;s not sourced, let&rsquo;s just source it! The way I used is calling <code>runtime</code>, and here is a simple example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vimrc" data-lang="vimrc"><span style="color:#a6e22e">autocmd</span> <span style="color:#a6e22e">FileType</span> <span style="color:#a6e22e">java</span> :<span style="color:#a6e22e">packadd</span> <span style="color:#a6e22e">vim</span>-<span style="color:#a6e22e">textobj</span>-<span style="color:#66d9ef">function</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    \ | <span style="color:#a6e22e">runtime</span>! <span style="color:#a6e22e">OPT</span> <span style="color:#a6e22e">after</span><span style="color:#e6db74">/ftplugin/</span><span style="color:#a6e22e">java</span>/<span style="color:#a6e22e">textobj</span>-<span style="color:#66d9ef">function</span>.<span style="color:#a6e22e">vim</span></code></pre></div>
<p>When given <code>OPT</code>, <code>:runtime</code> will search the following files in the optional packages in <code>packpath</code>, which is the case we want. <code>!</code> simply means to source every matched files. The given match format should mimic the file structure under a particular package or plugin, as the example shows.</p>

<h2 id="extra">Extra</h2>

<p>If we add <code>LanguageClient-neovim</code> also as an optional package, it will
not autostart the servers correctly since the related code is in
<code>autoload</code>. If we want to lazily set up the LSP related stuff when we
open files of the supported types, an easy solution will be:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vimrc" data-lang="vimrc"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">LC_starts</span>()<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">has_key</span>(<span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">LanguageClient_serverCommands</span>, &amp;<span style="color:#a6e22e">filetype</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">quinoa42_loaded_lsp</span> = <span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">        &#34; fancy stuff here ...</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>        <span style="color:#a6e22e">LanguageClientStart</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">endif</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">endfunction</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">augroup</span> <span style="color:#a6e22e">Lazy_Loaded_LSP</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">au</span>!<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">autocmd</span> <span style="color:#a6e22e">FileType</span> <span style="color:#a6e22e">rust</span>,<span style="color:#a6e22e">java</span>,<span style="color:#a6e22e">python</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>                    \ <span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">exists</span>(<span style="color:#e6db74">&#39;g:quinoa42_loaded_lsp&#39;</span>) |<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>                    \ <span style="color:#a6e22e">call</span> <span style="color:#a6e22e">LC_starts</span>() |<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>                    \ <span style="color:#66d9ef">endif</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">augroup</span> <span style="color:#a6e22e">END</span></code></pre></div>
<h2 id="reference">Reference</h2>

<ul>
<li><a href="https://neovim.io/doc/user/repeat.html#:packadd">Documentation about packages and packadd from Neovim</a></li>
</ul>

      </article>
  
      <article class="post-item">
        <header>
          <div class="tt">
            <h1><a href="/en/oceanus/eclim-setup/">Eclim Setup</a></h1>
            <time>10-12-2017</time>
          </div>
          <div class="reading-info">
            <div class="left">
             <div class="tags">
    &#x1f3f7;
    <nav class="jumplist">
        <ul>
          
    
    
    <li><a href="https://quinoa42.github.io/en/categories/software/">software</a></li>
    


          
    
    
    <li><a href="https://quinoa42.github.io/en/tags/eclim/">eclim</a></li>
    

    
    
    <li><a href="https://quinoa42.github.io/en/tags/vim/">Vim</a></li>
    


        </ul>
    </nav>
</div>

            </div>
            <div class="right">
              <span>447 words</span>
              <span>
                &bull;
              </span>
              <span>3 min read</span>
            </div>
          </div>
        </header>
        

<p>Today I come into the situation where I am forced to use Eclipse, one of those huge IDEs that isolate me from the warm terminal world. However, as a user of (neo)vim, nothing can stop me from doing things in a, at least, vim-like environment. At this moment, one tool comes into my mind: <a href="http://eclim.org/index.html">Eclim</a>, which I have been wondering about since the time when I was still using Windows XP back in my high school.</p>

<h2 id="get-the-necessary-stuffs">Get the necessary stuffs</h2>

<p>Firstly, download <a href="http://www.eclipse.org/downloads/eclipse-packages/">Eclipse</a>, in my case Eclipse for Java Developers, which I download &amp; install via
<code>brew cask</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">brew cask install eclipse-java</code></pre></div>
<p>Then, download the <code>eclim.jar</code> from the github repo <a href="https://github.com/ervandew/eclim/releases/">releases page</a>.</p>

<p>At this step, assume Eclipse and (neo)vim should all be installed on your computer; it&rsquo;s the time to install eclim. This could be done by just typing <code>java -jar eclim_2.7.0.jar</code> and use the GUI tool to finish the installing process. But for me I&rsquo;d written a tiny lovely piece of code to help me do it automatically by using the provided <a href="http://eclim.org/install.html#unattended-automated-install">Automated install</a> feature (this is also useful when you want to uninstall it):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>
VIMPLUGIN_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$HOME<span style="color:#e6db74">/.config/eclim&#34;</span>

ECLIPSE_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/Applications/Eclipse Java.app/Contents/Eclipse&#34;</span>

<span style="color:#66d9ef">if</span>  <span style="color:#f92672">[[</span> $1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;install&#34;</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">||</span> <span style="color:#f92672">[[</span> $1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;uninstall&#34;</span> <span style="color:#f92672">]]</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">[[</span> -f $2 <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
    java <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        -Dvim.files<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$VIMPLUGIN_PATH<span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        -Declipse.home<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$ECLIPSE_PATH<span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        -jar <span style="color:#e6db74">&#34;</span>$2<span style="color:#e6db74">&#34;</span> $1
<span style="color:#66d9ef">else</span>
    echo <span style="color:#e6db74">&#34;Usage: </span>$0<span style="color:#e6db74"> [install|uninstall] [eclim.jar]&#34;</span>
    exit <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">fi</span></code></pre></div>
<h2 id="set-it-up-with--neo--vim">Set it up with (neo)vim</h2>

<p>Note that with the default setting in my script, I actually installed Eclim to a directory <code>~/.config/eclim</code> instead of <code>.vim</code>. This is because I want to use <a href="https://github.com/junegunn/vim-plug">vim-plug</a> to constrain it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vimrc" data-lang="vimrc"><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">executable</span>(<span style="color:#e6db74">&#39;eclimd&#39;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">Plug</span> <span style="color:#e6db74">&#39;~/.config/eclim&#39;</span>, { <span style="color:#e6db74">&#39;for&#39;</span> : <span style="color:#e6db74">&#39;java&#39;</span> }<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">endif</span></code></pre></div>
<p>Also remember to add <code>/Applications/Eclipse Java.app/Contents/Eclipse/eclimd</code> to your path. One last thing is that to use its completion with deoplete, just add this to your <code>vimrc</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vimrc" data-lang="vimrc"><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">executable</span>(<span style="color:#e6db74">&#39;eclimd&#39;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">EclimCompletionMethod</span> = <span style="color:#e6db74">&#39;omnifunc&#39;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">endif</span></code></pre></div>
<h2 id="compatible-with-javacomplete2">compatible with javacomplete2</h2>

<p>It&rsquo;s not a good idea to have both Eclim and <code>javacomplete2</code> filling up the candidates for deoplete.</p>

<p>So there is a workaround on <a href="http://blog.csdn.net/Listener%5Fri/article/details/50452572">CSDN</a>, which basically tests the return value of <code>eclim#project#util#GetCurrentProjectName()</code> to determine if the java file is in a project (and thus should use the completion provided by Eclim). Here is my version of code for my personal use:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vimrc" data-lang="vimrc"><span style="color:#66d9ef">function</span>! <span style="color:#a6e22e">Java_autocomplete</span>()<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">eclim</span>#<span style="color:#a6e22e">project</span>#<span style="color:#a6e22e">util</span>#<span style="color:#a6e22e">GetCurrentProjectName</span>() == <span style="color:#e6db74">&#39;&#39;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">b</span>:<span style="color:#a6e22e">deoplete_omni_functions</span> = [<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>                    \ <span style="color:#e6db74">&#39;javacomplete#Complete&#39;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>                    \]<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">else</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">b</span>:<span style="color:#a6e22e">deoplete_omni_functions</span> = [<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>                    \ <span style="color:#e6db74">&#39;eclim#java#complete#CodeComplete&#39;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>                    \]<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">endif</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">endfunction</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">augroup</span> <span style="color:#a6e22e">Java_deoplete</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">au</span>!<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">autocmd</span> <span style="color:#a6e22e">FileType</span> <span style="color:#a6e22e">java</span> <span style="color:#a6e22e">call</span> <span style="color:#a6e22e">Java_autocomplete</span>()<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">augroup</span> <span style="color:#a6e22e">END</span></code></pre></div>
<p>Note that still <code>javacomplete2</code> will be load on background when a java file is opened, so it might slow down opening (neo)vim a lot. Since there seems to be no better solution, I comment out <code>Plug 'artur-shaik/vim-javacomplete2', { 'for' : 'java' }</code> by default.</p>

<h2 id="reference">Reference</h2>

<ul>
<li><a href="http://blog.csdn.net/Listener%5Fri/article/details/50452572">Solution on CSDN by ListenerRi</a></li>
</ul>

      </article>
  
      <article class="post-item">
        <header>
          <div class="tt">
            <h1><a href="/en/oceanus/neovim-python/">Python environment configuration for Neovim</a></h1>
            <time>06-30-2017</time>
          </div>
          <div class="reading-info">
            <div class="left">
             <div class="tags">
    &#x1f3f7;
    <nav class="jumplist">
        <ul>
          
    
    
    <li><a href="https://quinoa42.github.io/en/categories/software/">software</a></li>
    


          
    
    
    <li><a href="https://quinoa42.github.io/en/tags/vim/">Vim</a></li>
    

    
    
    <li><a href="https://quinoa42.github.io/en/tags/python/">Python</a></li>
    

    
    
    <li><a href="https://quinoa42.github.io/en/tags/osx/">OSX</a></li>
    


        </ul>
    </nav>
</div>

            </div>
            <div class="right">
              <span>569 words</span>
              <span>
                &bull;
              </span>
              <span>3 min read</span>
            </div>
          </div>
        </header>
        

<p>Today I managed to set up the Python environment for Neovim, which is a little bit tricky, so I decide to write down the problems I overcame so that someone could be helped to configure these easily.</p>

<h2 id="install-pyenv">install pyenv</h2>

<p>The installing process is similar to <a href="/en/oceanus/ruby-setup/">Ruby Setup</a> here, just install <a href="https://github.com/pyenv/pyenv">pyenv</a> instead. Don&rsquo;t forget to also install <a href="https://github.com/pyenv/pyenv-virtualenv">pyenv-virtualenv</a>, which is a handy tool in addition to <code>pyenv</code> that is capable of conveniently managing <code>virtualenv</code>.</p>

<h2 id="set-up-virtualenv">set up virtualenv</h2>

<p>See <a href="https://github.com/zchee/deoplete-jedi/wiki/Setting-up-Python-for-Neovim">here</a> for more details.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">pyenv install --list <span style="color:#75715e"># list all the available versions</span>
pyenv install <span style="color:#ae81ff">2</span>.7.13 <span style="color:#75715e"># latest python2</span>
pyenv install <span style="color:#ae81ff">3</span>.6.1 <span style="color:#75715e"># latest python3</span>

pyenv virtualenv <span style="color:#ae81ff">2</span>.7.13 neovim2 <span style="color:#75715e"># virtualenv for python2</span>
pyenv activate neovim2
pip install neovim
pyenv deactive

pyenv virtualenv <span style="color:#ae81ff">3</span>.6.1 neovim3 <span style="color:#75715e"># virtualenv for python3</span>
pyenv activate neovim3
pip install neovim
pyenv deactivate</code></pre></div>
<p>Then, we need to set the path for python provider in your Neovim config file (e.g. =init.nvim=):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vimrc" data-lang="vimrc"><span style="color:#75715e">&#34; Python provider</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">has</span>(<span style="color:#e6db74">&#34;nvim&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">python_host_prog</span> = $<span style="color:#a6e22e">HOME</span> . <span style="color:#e6db74">&#34;/.pyenv/versions/neovim2/bin/python&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">python3_host_prog</span> = $<span style="color:#a6e22e">HOME</span> . <span style="color:#e6db74">&#34;/.pyenv/versions/neovim3/bin/python&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">endif</span></code></pre></div>
<p>Restart Neovim and then check if the providers work successfully:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">:CheckHealth</code></pre></div>
<p>It is supposed to print out <code>SUCCESS</code> in both <code>python2</code> and <code>python3</code> parts.</p>

<h2 id="things-you-probably-need">Things you probably need</h2>

<p>I personally use <a href="https://github.com/junegunn/vim-plug">vim-plug</a> to manage my plugins, <a href="https://github.com/Shougo/deoplete.nvim">deoplete</a> to implement autocompletion, and <a href="https://github.com/w0rp/ale">ale</a> to lint/fix my code. And for Python I use <a href="https://github.com/davidhalter/jedi">jedi</a> to analysis my code and support autocompletion, <a href="https://pypi.python.org/pypi/flake8">flake8</a> as the linter, <a href="https://github.com/google/yapf">YAPF</a> and <a href="https://github.com/timothycrosley/isort">isort</a> as the &ldquo;fixers&rdquo;.</p>

<p>First, install all these python tools (I personally install them for Python3):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">pyenv activate neovim3
python3 -m pip install flake8
pip install jedi
pip install yapf
pip install isort
pyenv deactivate</code></pre></div>
<p>Install the plugins via <code>vim-plug</code> for Neovim if you haven&rsquo;t (you can use something else if you want):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vimrc" data-lang="vimrc"><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">has</span>(<span style="color:#e6db74">&#34;nvim&#34;</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">Plug</span> <span style="color:#e6db74">&#39;w0rp/ale&#39;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">Plug</span> <span style="color:#e6db74">&#39;Shougo/deoplete.nvim&#39;</span>, { <span style="color:#e6db74">&#39;do&#39;</span> : <span style="color:#e6db74">&#39;:UpdateRemotePlugins&#39;</span> }<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">Plug</span> <span style="color:#e6db74">&#39;Shougo/echodoc.vim&#39;</span> <span style="color:#75715e">&#34; it can show function def at the command line</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">Plug</span> <span style="color:#e6db74">&#39;zchee/deoplete-jedi&#39;</span>, { <span style="color:#e6db74">&#39;for&#39;</span> : <span style="color:#e6db74">&#39;python&#39;</span> } <span style="color:#75715e">&#34; deoplete source for python</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">endif</span></code></pre></div>
<p>Next, if you want, manually set the linter/fixer for <code>ale</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vimrc" data-lang="vimrc"><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">ale_linters</span> = {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>            \   <span style="color:#e6db74">&#39;python&#39;</span> : [<span style="color:#e6db74">&#39;flake8&#39;</span>],<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>            \}<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">ale_fixers</span> = {<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>            \   <span style="color:#e6db74">&#39;python&#39;</span>: [<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>            \       <span style="color:#e6db74">&#39;yapf&#39;</span>,<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>            \       <span style="color:#e6db74">&#39;isort&#39;</span>,<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>            \   ],<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>            \}</code></pre></div>
<p>Here is the tricky part. Since our special virtualenv(s) for Neovim is not activated usually, <code>pyenv</code> will prevent Neovim to call the executables. So we have to set the executable paths manually:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vimrc" data-lang="vimrc"><span style="color:#75715e">&#34; use flake8 installed at the virtualenv for neovim</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">ale_python_flake8_executable</span> = $<span style="color:#a6e22e">HOME</span> . <span style="color:#e6db74">&#34;/.pyenv/versions/neovim3/bin/flake8&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">ale_python_flake8_use_global</span> = <span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">&#34; use yapf installed at the virtualenv for neovim</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">ale_python_yapf_executable</span> = $<span style="color:#a6e22e">HOME</span> . <span style="color:#e6db74">&#34;/.pyenv/versions/neovim3/bin/yapf&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">ale_python_yapf_use_global</span> = <span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">&#34; use isort installed at the virtualenv for neovim</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">ale_python_isort_executable</span> = $<span style="color:#a6e22e">HOME</span> . <span style="color:#e6db74">&#34;/.pyenv/versions/neovim3/bin/isort&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">ale_python_isort_use_global</span> = <span style="color:#ae81ff">1</span></code></pre></div>
<p>As a problem I encountered, the intended global config file for <code>YAPF</code>, located at <code>~/.config/yapf/style</code>, is not used when called from <code>ale</code>. Put the file at <code>~/.style.yapf</code> would fix this problem.</p>

<p>One last thing about fixers and linters is that the preceding result will be overwrited by the following ones. For example, when calling <code>ALEFix</code>, my configuration will cause <code>isort</code> to run after <code>YAPF</code>, which will potentially generate some blank lines. I don&rsquo;t have perfect solution for this yet, but run <code>ALEFix</code> again could fix these empty lines.</p>

<p>There are many other settings for the plugins. You can check out my <a href="https://github.com/quinoa42/dotfiles/blob/master/applications/nvim/init.vim#L288">dotfiles repo</a> if you are interested.</p>

<p>Note that there are some useful plugins for Python that worth having a look:</p>

<ul>
<li><a href="https://github.com/python-mode/python-mode">python-mode</a></li>
<li><a href="https://github.com/vim-python/python-syntax">python-syntax</a></li>
</ul>

<h2 id="reference">reference</h2>

<ul>
<li><a href="https://github.com/pyenv/pyenv">pyenv github repo</a></li>
<li><a href="https://github.com/pyenv/pyenv-virtualenv">pyenv-virtualenv github repo</a></li>
<li><a href="https://github.com/zchee/deoplete-jedi/wiki/Setting-up-Python-for-Neovim">Setting up Python for Neovim</a></li>
</ul>

      </article>
  

    </main>
    <footer id="footer">
    
    <hr />
    <div><a href="https://github.com/quinoa42">GitHub</a></div>
    <div><a href="https://bgm.tv/user/112851">Bangumi</a></div>
    <div><a href="https://myanimelist.net/profile/quinoa42">MyAnimeList</a></div>
    
    </footer>
  </body>
</html>
